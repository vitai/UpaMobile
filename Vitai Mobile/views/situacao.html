<div   data-role="view"  data-title="Situação" data-layout="main" 
    data-model="app.situacaoService.viewModel" 
    data-bind="events:{beforeShow:onBeforeShowView, init:onInit}"  data-init="mobileListViewPullToRefresh" >
     
    <div data-role="header">
      <div data-role="navbar">
          <div >
              <a data-role="backbutton" data-align="left" data-icon="home"></a>
              
              <span data-role="view-title" style="line-height:1.8em"></span>
              <a data-role="button" data-align="right" data-icon="refresh" data-bind="click: onUpdate" ></a>
              
          </div>
      </div>
    </div>    
    <table style="width:100%; background-color:white">
        <tr>
            <td style="width:20%" >
              <div id="logo" data-bind="attr:{class:logo}">
                </div>
            </td> 
            <td style="width:80%; text-align:center" ><h3><div data-bind="html: descricaoUnidade">
                
                </div> 
                </h3>
    <span data-bind="text: dataAtualizacao" ></span>                
            </td>
        </tr>
    </table>
    
    <div class="list-view-wrapper">
        
    
        <div  class="helpIcon2" onclick="showHelpText('teste')" >
        </div><h2 class="listHeader2" >PACIENTES</h2>
        <ul  data-auto-bind="false"  data-role="listview" data-style="inset" data-template="situacaoTemplate" data-bind="source: dataSourcePaciente"></ul>
    </div>
        <div class="list-view-wrapper">
        
    
        <div  class="helpIcon2" onclick="showHelpText('teste')" >
        </div><h2 class="listHeader2" >FILA CLASSIF. DE RISCO</h2>
    <ul  data-auto-bind="false"  data-role="listview" data-style="inset" data-template="situacaoTemplate" data-bind="source: dataSourceClass"></ul>
    </div>
    
    <ul  data-auto-bind="false"  data-role="listview" data-style="inset" data-template="situacaoTemplate" data-header-template="headerTemplate" data-type="group" data-bind="source: dataSourceCons, events:{dataBound: onListDataboud}"></ul>
    <div class="list-view-wrapper">
        
    
        <div  class="helpIcon2" onclick="showHelpText('teste')" >
        </div><h2 class="listHeader2" >PRESCRIÇÕES</h2>
        <ul  data-auto-bind="false"  data-role="listview" data-style="inset" data-template="situacaoTemplate" data-bind="source: dataSourcePres"></ul>
    </div>
        <div class="list-view-wrapper">
        
    
        <div  class="helpIcon2" onclick="showHelpText('teste')" >
        </div><h2 class="listHeader2" >OBSERVAÇÃO</h2>
    <ul  data-auto-bind="false"  data-role="listview" data-style="inset" data-template="contactsTemplate" data-bind="source: dataSourceLeito"></ul>
    </div>
    <!--<ul  data-auto-bind="false"  data-role="listview" data-style="inset" data-template="contactsTemplate" data-header-template="headerTemplate" data-type="group" data-bind="source: dataSource, events:{dataBound: onListDataboud}"></ul>-->
    
</div>

<div data-role="modalview" id="modalview-help" style="width: 90%;">

            <div class="helpIcon">
            
        </div>

    <div class="btnContent">
        <a data-role="button" onclick="closeHelp();">Fechar</a>
    </div> 
    <div id="modalContent">
        
    </div>
    
</div>



<script type="text/x-kendo-template" id="headerTemplate">

    
    <div data-id="${value}"  class="helpIcon" onclick="showHelp(${value})" >
    
    </div><h2 class="listHeader" >${value}</h2>
    
</script>

<script type="text/x-kendo-template" id="situacaoTemplate">

     #if(data.LINKTO && data.VALOR > 0){#
         
         <a href='views/consultorioView.html?risco=#:data.DESCRICAO#&ordem=#:data.ORDEM#' data-role="list-view-link" >
         <div style="display:inline-block">#: data.DESCRICAO #:</div> <div style="display:inline-block;float:right; margin-right:20px"><b>#: data.VALOR #</b></div>
         </a>
     #}else{#
     
         <div style="display:inline-block">#: data.DESCRICAO #:</div> <div style="display:inline-block;float:right; margin-right:20px"><b>#: data.VALOR #</b></div>
     #}#
      
     
</script>

<script type="text/x-kendo-template" id="contactsTemplate">

     #if(data.LINKTO && data.VALOR > 0){#
     
         
         <a href='views/consultorioView.html?risco=#:data.DESCRICAO#&ordem=#:data.ORDEM#' data-role="list-view-link" >
         <div style="display:inline-block">#: data.DESCRICAO #:</div> <div style="display:inline-block;float:right; margin-right:20px"><b>#: data.VALOR #</b></div>
         </a>
     
     #}else if(data.LINKTO && data.VALOR.substring(0,1) > 0){#

        <a href='views/observacaoView.html?secao=#:data.CHAVE#&nmsecao=#:data.DESCRICAO#' data-role="list-view-link" >
         <div style="display:inline-block">#: data.DESCRICAO #:</div> <div style="display:inline-block; float:right; margin-right:20px"><b>#: data.VALOR #</b></div>
         </a>
     
     #}else{#
     
         <div style="display:inline-block">#: data.DESCRICAO #:</div> <div style="display:inline-block;float:right; margin-right:20px"><b>#: data.VALOR #</b></div>
     #}#
      
     
</script>

<script>
    function redirectBack()
    {
        app.situacaoService.viewModel.dataSource.read();
    }
    
    function showHelpText(text)
    {
        $("#modalContent").html(text);
        $("#modalview-help").data("kendoMobileModalView").open();
    }
    
    function showHelp(id)
    {
        $("#modalContent").html(app.situacaoService.viewModel.observacoes[id-1]);
        $("#modalview-help").data("kendoMobileModalView").open();
    }
    function closeHelp()
    {
        $("#modalview-help").data("kendoMobileModalView").close();
    }
</script>
